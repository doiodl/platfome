{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _possibleConstructorReturn2 = _interopRequireDefault(require(\"@babel/runtime/helpers/possibleConstructorReturn\"));\n\nvar _getPrototypeOf3 = _interopRequireDefault(require(\"@babel/runtime/helpers/getPrototypeOf\"));\n\nvar _assertThisInitialized2 = _interopRequireDefault(require(\"@babel/runtime/helpers/assertThisInitialized\"));\n\nvar _inherits2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inherits\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nvar _removeObjectKeys = _interopRequireDefault(require(\"../../lib/removeObjectKeys\"));\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _Alert = _interopRequireDefault(require(\"../Alert/Alert\"));\n\nvar _ActionSheet = _interopRequireDefault(require(\"../ActionSheet/ActionSheet\"));\n\nvar _ActionSheetItem = _interopRequireDefault(require(\"../ActionSheetItem/ActionSheetItem\"));\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(source, true).forEach(function (key) {\n        (0, _defineProperty2.default)(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(source).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction brToNl() {\n  var str = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n  var regex = /<br\\s*\\/?>/gi;\n  return str.replace(regex, '\\n');\n}\n\nvar actionId = 1;\n/**\n * @deprecated будет удален в 3.0.0\n */\n\nvar NativePopouts =\n/*#__PURE__*/\nfunction (_React$Component) {\n  (0, _inherits2.default)(NativePopouts, _React$Component);\n\n  function NativePopouts() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    (0, _classCallCheck2.default)(this, NativePopouts);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = (0, _possibleConstructorReturn2.default)(this, (_getPrototypeOf2 = (0, _getPrototypeOf3.default)(NativePopouts)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"state\", {\n      popout: null\n    });\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"actions\", []);\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"actionsStore\", {});\n    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), \"vkuiListener\", function (e) {\n      if (e.type === 'VKWebAppEvent' && e.detail && e.detail.action) {\n        if (_this.actionsStore.hasOwnProperty(e.detail.action)) {\n          _this.actionsStore[e.detail.action](e.detail);\n\n          _this.props.popout && _this.props.popout.onClose && _this.props.popout.onClose();\n        }\n      }\n    });\n    return _this;\n  }\n\n  (0, _createClass2.default)(NativePopouts, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.props.vkuiConnect.subscribe(this.vkuiListener);\n\n      if (this.props.popout) {\n        this.renderPopout(this.props);\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.props.vkuiConnect.unsubscribe(this.vkuiListener);\n    }\n  }, {\n    key: \"renderNativeAlert\",\n    value: function renderNativeAlert(popout) {\n      var style = popout.style,\n          title = popout.title,\n          message = popout.text;\n      this.props.vkuiConnect.send('VKWebAppAlert', {\n        style: style,\n        title: brToNl(title),\n        message: brToNl(message),\n        actions: this.actions.map(function (item) {\n          return (0, _removeObjectKeys.default)(item, ['action']);\n        })\n      });\n    }\n  }, {\n    key: \"renderUIAlert\",\n    value: function renderUIAlert(popout) {\n      var title = popout.title,\n          text = popout.text,\n          onClose = popout.onClose,\n          actionsLayout = popout.actionsLayout;\n      this.setState({\n        popout: _react.default.createElement(_Alert.default, {\n          actions: this.actions.map(function (item) {\n            return (0, _removeObjectKeys.default)(item, ['params']);\n          }),\n          onClose: onClose,\n          actionsLayout: actionsLayout\n        }, title && _react.default.createElement(\"h2\", null, title), text && _react.default.createElement(\"p\", null, text))\n      });\n    }\n  }, {\n    key: \"renderNativeSheet\",\n    value: function renderNativeSheet(popout) {\n      var style = popout.style;\n      this.props.vkuiConnect.send('VKWebAppAlert', {\n        style: style,\n        actions: this.actions.map(function (item) {\n          return (0, _removeObjectKeys.default)(item, ['action']);\n        })\n      });\n    }\n  }, {\n    key: \"renderUISheet\",\n    value: function renderUISheet(popout) {\n      var title = popout.title,\n          text = popout.text,\n          onClose = popout.onClose;\n      this.setState({\n        popout: _react.default.createElement(_ActionSheet.default, {\n          title: title,\n          text: text,\n          onClose: onClose\n        }, this.actions.map(function (item, index) {\n          return _react.default.createElement(_ActionSheetItem.default, {\n            autoclose: item.autoclose,\n            theme: item.style,\n            onClick: item.action,\n            key: \"\".concat(index)\n          }, item.title);\n        }))\n      });\n    }\n  }, {\n    key: \"closeUIPopout\",\n    value: function closeUIPopout() {\n      this.setState({\n        popout: null\n      });\n    }\n  }, {\n    key: \"renderPopout\",\n    value: function renderPopout(props) {\n      if (props.popout.style) {\n        this.actions = props.popout.actions.map(function (item) {\n          return _objectSpread({}, item, {\n            autoclose: item.hasOwnProperty('autoclose') ? item.autoclose : true,\n            action: item.action || props.popout.onClose,\n            handler: _objectSpread({}, item.params, {\n              action: \"action-\".concat(actionId++)\n            })\n          });\n        });\n        this.actionsStore = this.actions.reduce(function (res, item) {\n          res[item.handler.action] = item.action;\n          return res;\n        }, {});\n\n        switch (props.popout.style) {\n          case 'alert':\n            this.context.isWebView ? this.renderNativeAlert(props.popout) : this.renderUIAlert(props.popout);\n            break;\n\n          case 'actionSheet':\n            this.context.isWebView ? this.renderNativeSheet(props.popout) : this.renderUISheet(props.popout);\n            break;\n        }\n      } else {\n        this.setState({\n          popout: props.popout\n        });\n      }\n    }\n  }, {\n    key: \"componentWillReceiveProps\",\n    value: function componentWillReceiveProps(nextProps) {\n      if (!nextProps.popout && this.props.popout) {\n        this.closeUIPopout();\n      }\n\n      if (nextProps.popout && nextProps.popout !== this.props.popout) {\n        this.context.isWebView && this.closeUIPopout();\n        this.renderPopout(nextProps);\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var Component = this.props.component;\n      return _react.default.createElement(Component, (0, _extends2.default)({}, (0, _removeObjectKeys.default)(this.props, ['popout']), {\n        popout: this.state.popout\n      }));\n    }\n  }]);\n  return NativePopouts;\n}(_react.default.Component);\n\nexports.default = NativePopouts;\n(0, _defineProperty2.default)(NativePopouts, \"propTypes\", {\n  popout: _propTypes.default.oneOfType([_propTypes.default.shape({\n    style: _propTypes.default.oneOf(['alert', 'actionSheet']).isRequired,\n    title: _propTypes.default.string,\n    text: _propTypes.default.string,\n    onClose: _propTypes.default.func.isRequired,\n    actions: _propTypes.default.arrayOf(_propTypes.default.shape({\n      style: _propTypes.default.oneOf(['cancel', 'default', 'destructive']),\n      title: _propTypes.default.string,\n      action: _propTypes.default.func\n    }))\n  }), _propTypes.default.element]),\n  vkuiConnect: _propTypes.default.object.isRequired,\n\n  /**\n   * Root or View\n   */\n  component: _propTypes.default.func.isRequired\n});\n(0, _defineProperty2.default)(NativePopouts, \"contextTypes\", {\n  isWebView: _propTypes.default.bool\n});","map":null,"metadata":{},"sourceType":"script"}